<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대화형 성격 및 적성 종합 평가</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals (e.g., bg-stone-50, text-stone-800, accent-teal-600) -->
    <!-- Application Structure Plan: A multi-step guided assessment SPA. The user progresses from an introduction through two questionnaires (Big Five, RIASEC) to a final, comprehensive results dashboard. This linear flow simplifies the complex report into a manageable user journey. The dashboard consolidates all results, using interactive charts (Radar for Big Five, Bar for RIASEC) and collapsible text sections to present information hierarchically, preventing cognitive overload and encouraging exploration. This structure is chosen for its clarity, user guidance, and ability to synthesize two distinct but related psychological models into one coherent output. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Big Five personality scores. Goal: Compare 5 balanced factors. Viz: Radar Chart (Chart.js). Interaction: Hover for tooltips. Justification: Shows the overall 'shape' of a personality profile effectively.
        - Report Info: RIASEC interest scores. Goal: Compare 6 distinct scores. Viz: Bar Chart (Chart.js). Interaction: Hover for tooltips. Justification: Clearly shows the hierarchy and relative strength of each interest type.
        - Report Info: Detailed text interpretations for each factor/type. Goal: Provide in-depth information without clutter. Presentation: Collapsible accordion sections (HTML/JS). Interaction: Click to expand/collapse. Justification: Allows users to drill down into details on demand.
        - Report Info: Career suggestions table. Goal: Allow easy exploration of careers. Presentation: Interactive HTML table. Interaction: JS-based search/filter. Justification: Transforms a static table into a usable exploration tool.
        - CONFIRMATION: NO SVG/Mermaid used. All visuals are Canvas-based charts or structured HTML/CSS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .section-fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .tab-button.active {
            border-color: #0d9488;
            color: #0d9488;
            font-weight: 700;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <div id="app" class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Introduction Section -->
        <section id="intro-section" class="text-center section-fade-in">
            <h1 class="text-4xl font-bold text-teal-800 mb-4">나를 찾아 떠나는 여정</h1>
            <p class="text-lg text-stone-600 mb-8 max-w-3xl mx-auto">이 평가는 과학적으로 검증된 'Big Five 성격 5요인 모델'과 'Holland 직업 흥미 모델(RIASEC)'을 통해 당신의 성격적 특성과 직업적 흥미를 종합적으로 탐색합니다. 자신에 대한 깊이 있는 이해를 통해 개인적, 직업적 성장을 위한 통찰을 얻어보세요.</p>
            
            <div class="max-w-md mx-auto mb-6 text-left">
                <div class="mb-4">
                    <label for="user-name" class="block text-stone-700 text-sm font-bold mb-2">이름</label>
                    <input type="text" id="user-name" placeholder="이름을 입력하세요" class="w-full p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                </div>
                <div>
                    <label for="user-birthdate" class="block text-stone-700 text-sm font-bold mb-2">생년월일</label>
                    <input type="date" id="user-birthdate" class="w-full p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                </div>
                <p id="intro-error" class="text-red-500 text-sm mt-2 h-4"></p>
            </div>

            <button id="start-btn" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition-colors text-xl shadow-lg">평가 시작하기</button>
            <div class="mt-8">
                <a href="#admin-login" id="admin-link" class="text-sm text-stone-400 hover:text-teal-600">관리자</a>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quiz-section" class="hidden section-fade-in">
            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                <h2 id="quiz-title" class="text-2xl font-bold text-teal-800 mb-2"></h2>
                <p id="quiz-subtitle" class="text-stone-500 mb-6"></p>
                
                <div class="w-full bg-stone-200 rounded-full h-2.5 mb-6">
                    <div id="progress-bar" class="bg-teal-500 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
                </div>

                <div id="question-container">
                    <!-- Questions will be dynamically inserted here -->
                </div>

                <div class="flex justify-between items-center mt-8">
                    <button id="prev-btn" class="bg-stone-200 text-stone-700 font-bold py-2 px-6 rounded-lg hover:bg-stone-300 transition-colors">이전</button>
                    <span id="question-counter" class="text-stone-500 font-medium"></span>
                    <button id="next-btn" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-700 transition-colors">다음</button>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section id="results-section" class="hidden section-fade-in">
            <div class="text-center mb-10">
                <h1 class="text-4xl font-bold text-teal-800 mb-2">종합 분석 결과</h1>
                <p class="text-lg text-stone-600">당신의 성격과 흥미 유형에 대한 분석 결과입니다.</p>
            </div>

            <!-- Tabs -->
            <div class="mb-8 border-b border-stone-200">
                <nav class="flex space-x-2 sm:space-x-4 -mb-px" aria-label="Tabs">
                    <button data-tab="summary" class="tab-button active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base text-stone-500 hover:text-teal-600 hover:border-teal-600 transition-colors">
                        종합 요약
                    </button>
                    <button data-tab="big-five" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base text-stone-500 hover:text-teal-600 hover:border-teal-600 transition-colors">
                        Big 5 성격 분석
                    </button>
                    <button data-tab="riasec" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base text-stone-500 hover:text-teal-600 hover:border-teal-600 transition-colors">
                        RIASEC 흥미 분석
                    </button>
                     <button data-tab="synthesis" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base text-stone-500 hover:text-teal-600 hover:border-teal-600 transition-colors">
                        성격과 흥미의 시너지
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div id="tab-content">
                <!-- Summary Tab -->
                <div id="summary-tab" class="tab-pane active">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-2xl shadow-lg">
                            <h3 class="text-2xl font-bold text-teal-800 mb-4">나의 성격 프로파일</h3>
                            <div class="chart-container">
                                <canvas id="bigFiveChart"></canvas>
                            </div>
                            <p id="big-five-summary" class="mt-4 text-stone-600"></p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg">
                            <h3 class="text-2xl font-bold text-teal-800 mb-4">나의 직업 흥미 코드</h3>
                            <div class="chart-container">
                                <canvas id="riasecChart"></canvas>
                            </div>
                             <p id="riasec-summary" class="mt-4 text-stone-600"></p>
                        </div>
                    </div>
                </div>

                <!-- Big Five Tab -->
                <div id="big-five-tab" class="tab-pane hidden">
                    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                        <h2 class="text-3xl font-bold text-teal-800 mb-2">Big Five 성격 5요인 심층 분석</h2>
                        <p class="text-stone-600 mb-8">각 성격 요인에 대한 상세한 설명입니다. 자신의 점수(높음, 보통, 낮음)에 해당하는 설명을 읽고 자신을 더 깊이 이해해 보세요.</p>
                        <div id="big-five-details" class="space-y-4"></div>
                    </div>
                </div>

                <!-- RIASEC Tab -->
                <div id="riasec-tab" class="tab-pane hidden">
                     <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                        <h2 class="text-3xl font-bold text-teal-800 mb-2">RIASEC 직업 흥미 심층 분석</h2>
                        <p class="text-stone-600 mb-8">자신의 Holland 코드(상위 3개 흥미 유형)를 중심으로 관련 직업과 전공 계열을 탐색해 보세요.</p>
                        <div id="riasec-details" class="space-y-4 mb-10"></div>
                        
                        <h3 class="text-2xl font-bold text-teal-800 mb-4">RIASEC 진로 탐색 대백과</h3>
                        <input type="text" id="career-search" placeholder="직업 또는 전공 검색..." class="w-full p-3 border border-stone-300 rounded-lg mb-4 focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                        <div class="overflow-x-auto">
                            <table id="career-table" class="min-w-full bg-white border border-stone-200">
                                <thead class="bg-stone-100">
                                    <tr>
                                        <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">Holland 코드</th>
                                        <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">유형 요약</th>
                                        <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">관련 전공 계열</th>
                                        <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">대표 직업</th>
                                    </tr>
                                </thead>
                                <tbody id="career-table-body">
                                    <!-- Career data will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Synthesis Tab -->
                <div id="synthesis-tab" class="tab-pane hidden">
                    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                        <h2 class="text-3xl font-bold text-teal-800 mb-2">성격과 흥미의 시너지 분석</h2>
                        <p class="text-stone-600 mb-8">당신의 성격(Big Five)과 흥미(RIASEC)가 어떻게 상호작용하는지 분석하고, 이를 바탕으로 개인의 강점을 극대화하며 잠재적 약점을 보완할 수 있는 전략을 제시합니다.</p>
                        <div id="synthesis-details" class="space-y-6 prose max-w-none prose-teal"></div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-12">
                <button id="restart-btn" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition-colors text-xl shadow-lg">다시 검사하기</button>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin-section" class="hidden section-fade-in">
            <div id="admin-login" class="bg-white p-8 rounded-2xl shadow-lg max-w-md mx-auto">
                <h2 class="text-2xl font-bold text-teal-800 mb-6 text-center">관리자 로그인</h2>
                <input type="password" id="admin-password" placeholder="비밀번호를 입력하세요" class="w-full p-3 border border-stone-300 rounded-lg mb-4 focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                <button id="admin-login-btn" class="w-full bg-teal-600 text-white font-bold py-3 rounded-lg hover:bg-teal-700 transition-colors">로그인</button>
            </div>

            <div id="admin-results" class="hidden bg-white p-6 sm:p-8 rounded-2xl shadow-lg mt-8">
                <h2 class="text-3xl font-bold text-teal-800 mb-6">전체 결과 목록</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white border border-stone-200">
                        <thead class="bg-stone-100">
                            <tr>
                                <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">검사일시</th>
                                <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">이름</th>
                                <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">생년월일</th>
                                <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">Big 5 (N,E,O,A,C)</th>
                                <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">RIASEC 코드</th>
                                <th class="py-3 px-4 text-left text-sm font-bold text-stone-600">RIASEC (R,I,A,S,E,C)</th>
                            </tr>
                        </thead>
                        <tbody id="admin-results-body">
                            <!-- Admin results will be inserted here -->
                        </tbody>
                    </table>
                </div>
                 <button id="admin-logout-btn" class="mt-6 bg-stone-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-stone-600 transition-colors">로그아웃</button>
            </div>
        </section>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";

        // =================================================================================
        // 중요: 아래 firebaseConfig 객체를 당신의 Firebase 프로젝트 설정에서 복사한 값으로 교체하세요.
        // =================================================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDWOX6T7qsOu_bg0gBiWaXdIJZLzf7R4-E",
            authDomain: "my-personality-test-41b0e.firebaseapp.com",
            projectId: "my-personality-test-41b0e",
            storageBucket: "my-personality-test-41b0e.firebasestorage.app",
            messagingSenderId: "741288666261",
            appId: "1:741288666261:web:8ebde812b7b58c737c279c"
        };
        // =================================================================================

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', () => {
            const appData = {
                bigFive: {
                    title: "제1부: 성격 평가",
                    subtitle: "Big Five(5요인 모델) 기반의 60문항 검사입니다.",
                    questions: [
                        { q: "나는 걱정이 많은 편이다.", factor: "N", score: 1 },
                        { q: "나는 새로운 경험을 하는 것을 즐긴다.", factor: "O", score: 1 },
                        { q: "나는 다른 사람의 감정에 잘 공감한다.", factor: "A", score: 1 },
                        { q: "나는 맡은 일을 끝까지 책임진다.", factor: "C", score: 1 },
                        { q: "나는 파티나 모임에서 중심이 되는 편이다.", factor: "E", score: 1 },
                        { q: "나는 스트레스를 받으면 쉽게 짜증을 낸다.", factor: "N", score: 1 },
                        { q: "나는 추상적이거나 철학적인 아이디어에 관심이 적다.", factor: "O", score: -1 },
                        { q: "나는 타인의 의도를 의심하는 경향이 있다.", factor: "A", score: -1 },
                        { q: "나는 일을 시작하기 전에 계획을 세우는 것을 좋아한다.", factor: "C", score: 1 },
                        { q: "나는 혼자 시간을 보내는 것을 더 선호한다.", factor: "E", score: -1 },
                        { q: "나는 종종 우울하거나 슬픈 감정을 느낀다.", factor: "N", score: 1 },
                        { q: "나는 상상력이 풍부하다.", factor: "O", score: 1 },
                        { q: "나는 다른 사람을 돕는 것에서 보람을 느낀다.", factor: "A", score: 1 },
                        { q: "나는 해야 할 일을 미루는 경향이 있다.", factor: "C", score: -1 },
                        { q: "나는 낯선 사람과도 쉽게 대화를 시작한다.", factor: "E", score: 1 },
                        { q: "나는 대체로 편안한 상태이며 스트레스를 잘 다룬다.", factor: "N", score: -1 },
                        { q: "나는 예술, 음악, 문학 등에 매력을 느낀다.", factor: "O", score: 1 },
                        { q: "나는 다른 사람과 논쟁을 시작하는 편이다.", factor: "A", score: -1 },
                        { q: "나는 주변을 항상 깔끔하게 정돈해 둔다.", factor: "C", score: 1 },
                        { q: "나는 말수가 적고 조용한 편이다.", factor: "E", score: -1 },
                        { q: "나는 사소한 일에도 쉽게 불안해진다.", factor: "N", score: 1 },
                        { q: "나는 틀에 박힌 일상을 선호하며 변화를 좋아하지 않는다.", factor: "O", score: -1 },
                        { q: "나는 다른 사람을 신뢰하는 편이다.", factor: "A", score: 1 },
                        { q: "나는 충동적으로 행동할 때가 있다.", factor: "C", score: -1 },
                        { q: "나는 활력이 넘치고 활동적이다.", factor: "E", score: 1 },
                        { q: "나는 감정 기복이 심한 편이다.", factor: "N", score: 1 },
                        { q: "나는 사물의 원리나 작동 방식에 대해 호기심이 많다.", factor: "O", score: 1 },
                        { q: "나는 다른 사람의 잘못을 너그럽게 용서한다.", factor: "A", score: 1 },
                        { q: "나는 한번 시작한 일은 끝을 봐야 직성이 풀린다.", factor: "C", score: 1 },
                        { q: "나는 주목받는 것을 불편해한다.", factor: "E", score: -1 },
                        { q: "나는 자신에 대해 편안하고 안정감을 느낀다.", factor: "N", score: -1 },
                        { q: "나는 창의적이며 새로운 아이디어를 잘 떠올린다.", factor: "O", score: 1 },
                        { q: "나는 때때로 다른 사람에게 무례하게 행동할 수 있다.", factor: "A", score: -1 },
                        { q: "나는 다소 부주의하고 실수가 잦은 편이다.", factor: "C", score: -1 },
                        { q: "나는 내 의견을 주장하는 데 자신감이 있다.", factor: "E", score: 1 },
                        { q: "나는 스트레스에 취약하다.", factor: "N", score: 1 },
                        { q: "나는 지적인 토론을 피하는 경향이 있다.", factor: "O", score: -1 },
                        { q: "나는 다른 사람의 장점을 먼저 보려고 한다.", factor: "A", score: 1 },
                        { q: "나는 체계적이며 일을 효율적으로 처리한다.", factor: "C", score: 1 },
                        { q: "나는 다른 사람들과의 상호작용에서 에너지를 얻는다.", factor: "E", score: 1 },
                        { q: "나는 쉽게 화를 내지 않고 감정을 잘 조절한다.", factor: "N", score: -1 },
                        { q: "나는 예술 작품이나 자연의 아름다움에 깊이 감동한다.", factor: "O", score: 1 },
                        { q: "나는 다른 사람의 의견에 쉽게 동조하는 편이다.", factor: "A", score: 1 },
                        { q: "나는 목표 달성을 위해 꾸준히 노력한다.", factor: "C", score: 1 },
                        { q: "나는 수줍음이 많고 내성적이다.", factor: "E", score: -1 },
                        { q: "나는 미래에 대해 비관적인 생각을 자주 한다.", factor: "N", score: 1 },
                        { q: "나는 다양한 가치관과 문화를 존중한다.", factor: "O", score: 1 },
                        { q: "나는 다른 사람을 돕기 위해 내 시간을 기꺼이 쓴다.", factor: "A", score: 1 },
                        { q: "나는 즉흥적이기보다는 신중하게 결정하는 편이다.", factor: "C", score: 1 },
                        { q: "나는 흥분과 자극을 추구하는 경향이 있다.", factor: "E", score: 1 },
                        { q: "나는 정서적으로 안정되어 있고 쉽게 동요하지 않는다.", factor: "N", score: -1 },
                        { q: "나는 복잡하고 깊이 있는 사색가이다.", factor: "O", score: 1 },
                        { q: "나는 다른 사람의 약점을 잡으려는 경향이 있다.", factor: "A", score: -1 },
                        { q: "나는 믿을 수 있고 의지가 되는 사람이다.", factor: "C", score: 1 },
                        { q: "나는 에너지가 넘치고 열정적인 모습을 자주 보인다.", factor: "E", score: 1 },
                        { q: "나는 종종 불안감이나 공포를 느낀다.", factor: "N", score: 1 },
                        { q: "나는 상상하는 것에 어려움을 느낀다.", factor: "O", score: -1 },
                        { q: "나는 차갑고 냉담하게 보일 수 있다.", factor: "A", score: -1 },
                        { q: "나는 해야 할 일을 시작하는 데 어려움을 겪는다.", factor: "C", score: -1 },
                        { q: "나는 조용하고 말이 없는 편이다.", factor: "E", score: -1 }
                    ],
                    interpretations: {
                        N: {
                            label: "신경성",
                            description: "신경성은 불안, 우울, 분노와 같은 부정적 정서를 얼마나 쉽게, 그리고 강하게 느끼는지를 나타내는 경향성입니다. 이 점수가 높을수록 정서적으로 민감하고 스트레스에 취약하며, 낮을수록 정서적으로 안정되고 평온한 경향을 보입니다.",
                            high: "<strong>높은 점수:</strong> 걱정이 많고, 사소한 일에도 쉽게 긴장하거나 좌절감을 느낄 수 있습니다. 감정의 기복이 크고, 비판에 민감하며, 스트레스 상황에서 평정심을 유지하기 어려워하는 경향이 있습니다. 이러한 정서적 민감성은 위험을 미리 감지하고 대비하게 하는 순기능도 있지만, 과도할 경우 만성적인 불안이나 낮은 자존감으로 이어질 수 있습니다.",
                            low: "<strong>낮은 점수:</strong> 정서적으로 매우 안정되어 있고, 스트레스 상황에서도 침착함과 평정심을 잘 유지합니다. 걱정이나 불안을 거의 느끼지 않으며, 대체로 느긋하고 자신감이 있습니다. 이러한 안정성은 위기 상황에서 강점이 되지만, 때로는 위험 신호를 무시하거나 지나치게 낙관적으로 상황을 판단하는 경향으로 나타날 수도 있습니다.",
                            mid: "<strong>보통 점수:</strong> 대부분의 사람들은 이 범위에 속합니다. 일상적인 스트레스에 어느 정도 영향을 받지만, 금방 회복하는 탄력성을 보입니다. 상황에 따라 불안이나 걱정을 느끼기도 하지만, 감정에 압도되지 않고 적절히 대처할 수 있는 능력을 갖추고 있습니다."
                        },
                        E: {
                            label: "외향성",
                            description: "외향성은 타인과의 사교적 상호작용, 자극, 활력을 추구하는 성향을 의미합니다. 점수가 높은 사람들은 사람들과 어울리며 에너지를 얻고, 낮을수록(내향성) 혼자만의 시간을 통해 에너지를 재충전하는 경향이 있습니다.",
                            high: "<strong>높은 점수:</strong> 사교적이고, 말이 많으며, 열정적입니다. 사람들과 함께 있는 것을 즐기고, 관심의 중심이 되는 것을 편안하게 느낍니다. 이들은 자신의 의견을 적극적으로 표현하며, 리더십을 발휘하는 경향이 있습니다. 다만, 지나칠 경우 충동적이거나 타인의 말을 경청하지 않는 모습으로 비칠 수 있습니다.",
                            low: "<strong>낮은 점수(내향성):</strong> 조용하고, 신중하며, 말하기보다는 듣는 것을 선호합니다. 소수의 깊은 관계를 선호하며, 대규모의 사교 모임에서는 쉽게 지칠 수 있습니다. 이들은 독립적으로 일하는 환경에서 집중력을 발휘하며, 깊이 있는 사고를 통해 문제를 해결하는 데 강점을 보입니다.",
                            mid: "<strong>보통 점수:</strong> 상황에 따라 사교적인 모습과 조용한 모습을 모두 보입니다. 혼자만의 시간도 즐기지만, 다른 사람들과 어울리는 것에도 어려움이 없습니다. 이들은 외향적인 사람과 내향적인 사람 모두와 잘 어울릴 수 있는 유연성을 가지고 있습니다."
                        },
                        O: {
                            label: "개방성",
                            description: "개방성은 새로운 경험, 아이디어, 가치, 감정 등에 대해 열려 있는 정도를 나타냅니다. 지적 호기심, 상상력, 창의성, 심미안 등과 관련이 깊습니다.",
                            high: "<strong>높은 점수:</strong> 창의적이고 상상력이 풍부하며, 지적 호기심이 많습니다. 이들은 변화와 다양성을 즐기며, 틀에 박힌 것을 싫어합니다. 예술, 과학, 철학 등 추상적인 아이디어를 탐구하는 것을 좋아하고, 여행이나 새로운 문화를 경험하는 것에서 큰 즐거움을 느낍니다.",
                            low: "<strong>낮은 점수:</strong> 실용적이고 현실적이며, 전통과 관습을 중시하는 경향이 있습니다. 이들은 익숙하고 검증된 방식을 선호하며, 추상적이거나 모호한 것보다는 구체적이고 명확한 것을 다루는 데 편안함을 느낍니다.",
                            mid: "<strong>보통 점수:</strong> 새로운 아이디어에 흥미를 느끼면서도 현실적인 측면을 고려하는 균형 잡힌 시각을 가지고 있습니다. 창의적인 접근과 실용적인 접근 사이에서 유연하게 사고할 수 있으며, 혁신과 안정 사이의 적절한 균형점을 찾는 데 능숙합니다."
                        },
                        A: {
                            label: "우호성",
                            description: "우호성은 타인에 대해 협조적이고 이타적인 태도를 보이는 성향을 의미합니다. 신뢰, 공감, 겸손, 배려심 등과 관련이 있으며, 대인 관계의 질과 밀접한 관련이 있습니다.",
                            high: "<strong>높은 점수:</strong> 친절하고, 동정심이 많으며, 다른 사람을 돕는 것을 좋아합니다. 이들은 타인을 신뢰하고, 갈등을 피하며 조화로운 관계를 유지하고자 노력합니다. 다만, 자신의 의견을 주장하거나 거절하는 데 어려움을 겪을 수 있습니다.",
                            low: "<strong>낮은 점수:</strong> 경쟁적이고, 비판적이며, 자신의 이익을 우선시하는 경향이 있습니다. 이들은 타인의 의견에 쉽게 동조하지 않고, 자신의 주장을 관철시키려는 의지가 강합니다. 이러한 성향은 협상이 필요하거나 힘든 결정을 내려야 하는 상황에서 강점이 될 수 있지만, 대인관계에서 잦은 갈등을 유발할 수 있습니다.",
                            mid: "<strong>보통 점수:</strong> 자신의 이익과 타인의 필요 사이에서 균형을 잘 잡습니다. 필요할 때는 협조적이지만, 자신의 의견이 다를 때는 분명하게 표현할 줄 압니다. 부드러우면서도 단호한 태도를 유지할 수 있습니다."
                        },
                        C: {
                            label: "성실성",
                            description: "성실성은 목표 지향적이고, 체계적이며, 책임감이 강한 성향을 나타냅니다. 자기 통제, 계획성, 신중함 등과 관련이 있으며, 성취와 성공을 예측하는 가장 중요한 요인 중 하나로 꼽힙니다.",
                            high: "<strong>높은 점수:</strong> 매우 조직적이고, 신뢰할 수 있으며, 책임감이 강합니다. 목표를 세우고 그것을 달성하기 위해 체계적으로 노력하며, 충동을 잘 조절하고 세부적인 사항까지 꼼꼼하게 챙깁니다. 다만, 지나치게 완벽주의적이거나 융통성이 부족하고, 일 중독에 빠질 위험이 있습니다.",
                            low: "<strong>낮은 점수:</strong> 즉흥적이고, 자유분방하며, 체계적인 계획보다는 유연한 접근을 선호합니다. 덜 조직적이고, 때로는 부주의하거나 무책임하게 보일 수 있습니다. 그러나 이러한 유연성은 예측 불가능한 상황이나 창의적인 문제 해결에 도움이 될 수 있습니다.",
                            mid: "<strong>보통 점수:</strong> 목표 달성을 위해 노력하지만, 과정에서 어느 정도의 유연성을 허용합니다. 계획을 세우지만 상황 변화에 따라 기꺼이 수정할 수 있으며, 일과 삶의 균형을 잘 유지하는 경향이 있습니다."
                        }
                    }
                },
                riasec: {
                    title: "제2부: 직업 흥미 평가",
                    subtitle: "Holland(RIASEC) 모델 기반의 48문항 검사입니다.",
                    questions: [
                        { q: "자동차 엔진을 수리한다.", type: "R" },
                        { q: "과학 실험을 설계하고 수행한다.", type: "I" },
                        { q: "소설이나 시를 쓴다.", type: "A" },
                        { q: "어려움에 처한 사람을 상담해 준다.", type: "S" },
                        { q: "팀을 이끌어 프로젝트를 성공시킨다.", type: "E" },
                        { q: "사무실의 서류와 파일을 체계적으로 정리한다.", type: "C" },
                        { q: "전기 회로를 조립하거나 수리한다.", type: "R" },
                        { q: "데이터를 분석하여 숨겨진 패턴이나 트렌드를 찾아낸다.", type: "I" },
                        { q: "회사의 로고나 포스터를 디자인한다.", type: "A" },
                        { q: "학생들에게 새로운 지식이나 기술을 가르친다.", type: "S" },
                        { q: "새로운 사업 아이템을 기획하고 투자자를 설득한다.", type: "E" },
                        { q: "회사의 예산을 세우고 지출을 관리한다.", type: "C" },
                        { q: "야외에서 식물을 재배하거나 동물을 돌본다.", type: "R" },
                        { q: "의학 논문을 읽고 새로운 치료법을 연구한다.", type: "I" },
                        { q: "연극 무대에서 연기하거나 영화를 감독한다.", type: "A" },
                        { q: "동아리나 커뮤니티 활동을 조직한다.", type: "S" },
                        { q: "상품을 판매하기 위한 마케팅 전략을 수립한다.", type: "E" },
                        { q: "컴퓨터 프로그램을 사용하여 데이터를 정확하게 입력한다.", type: "C" },
                        { q: "목공 도구를 사용하여 가구를 만든다.", type: "R" },
                        { q: "사회 현상의 원인을 분석하고 보고서를 작성한다.", type: "I" },
                        { q: "악기를 연주하거나 노래를 작곡한다.", type: "A" },
                        { q: "다른 사람의 고민을 들어주고 정서적 지지를 보낸다.", type: "S" },
                        { q: "회의를 주재하고 토론을 이끌어간다.", type: "E" },
                        { q: "정해진 절차와 규칙에 따라 업무를 처리한다.", type: "C" },
                        { q: "최신 기계를 조작하거나 프로그래밍한다.", type: "R" },
                        { q: "컴퓨터 프로그래밍 언어를 사용하여 소프트웨어를 개발한다.", type: "I" },
                        { q: "사진을 찍거나 영상을 편집하여 작품을 만든다.", type: "A" },
                        { q: "자원봉사 활동에 참여하여 지역 사회에 기여한다.", type: "S" },
                        { q: "다른 사람들에게 업무를 지시하고 성과를 관리한다.", type: "E" },
                        { q: "재고 목록을 관리하고 필요한 물품을 주문한다.", type: "C" },
                        { q: "건물 설계도를 그리거나 건축 현장을 감독한다.", type: "R" },
                        { q: "현미경으로 세포나 미생물을 관찰한다.", type: "I" },
                        { q: "옷이나 장신구를 디자인한다.", type: "A" },
                        { q: "팀원들 간의 갈등을 중재하고 해결한다.", type: "S" },
                        { q: "비즈니스 협상에서 우리 측의 이익을 대변한다.", type: "E" },
                        { q: "법률 문서나 계약서를 꼼꼼하게 검토한다.", type: "C" },
                        { q: "운동선수로서 신체 능력을 단련한다.", type: "R" },
                        { q: "우주나 자연의 신비에 대해 탐구한다.", type: "I" },
                        { q: "인테리어를 디자인하여 공간을 아름답게 꾸민다.", type: "A" },
                        { q: "간병이 필요한 환자나 노인을 돌본다.", type: "S" },
                        { q: "대중 앞에서 연설하여 사람들을 설득한다.", type: "E" },
                        { q: "회계 장부를 작성하고 재무 보고서를 만든다.", type: "C" },
                        { q: "항공기를 조종하거나 정비한다.", type: "R" },
                        { q: "시장 조사를 통해 소비자의 행동을 예측한다.", type: "I" },
                        { q: "웹사이트나 앱의 사용자 인터페이스(UI)를 디자인한다.", type: "A" },
                        { q: "다른 사람의 성장을 돕는 멘토 역할을 한다.", type: "S" },
                        { q: "조직의 목표 달성을 위해 사람들을 동기 부여한다.", type: "E" },
                        { q: "도서관의 책을 분류하고 정리한다.", type: "C" }
                    ],
                    interpretations: {
                        R: { label: "현실형 (Realistic)", description: "실용적, 신체적, 도구/기계 조작을 선호하는 '행동가' 유형입니다. 솔직하고 성실하며, 추상적인 이론보다는 구체적이고 실재적인 대상을 다루는 것을 선호하고, 신체적인 활동과 손을 사용하는 작업에서 만족감을 느낍니다." },
                        I: { label: "탐구형 (Investigative)", description: "분석적, 지적, 과학적/수학적 탐구를 즐기는 '사고가' 유형입니다. 지적 호기심이 많고, 논리적, 합리적인 성향을 가지며, 복잡한 문제를 관찰하고 탐구하여 해결책을 찾는 과정 자체를 즐깁니다." },
                        A: { label: "예술형 (Artistic)", description: "창의적, 표현적, 비구조적/심미적 활동을 선호하는 '창조가' 유형입니다. 상상력이 풍부하고, 감수성이 예민하며, 개방적이고 독창적입니다. 자유분방하고 개성이 강하며, 틀에 얽매이는 것을 싫어합니다." },
                        S: { label: "사회형 (Social)", description: "협동적, 이타적, 타인 지원/교육에 흥미를 느끼는 '조력가' 유형입니다. 사람들을 좋아하고, 친절하며, 이해심이 많습니다. 다른 사람을 돕고, 봉사하며, 가르치는 것에서 큰 보람을 느낍니다." },
                        E: { label: "진취형 (Enterprising)", description: "설득적, 야망적, 리더십/경영 활동을 추구하는 '설득가' 유형입니다. 야망이 있고, 사교적이며, 설득력이 뛰어납니다. 리더십을 발휘하여 조직의 목표를 달성하거나 경제적 이익을 추구하는 데 동기 부여를 받습니다." },
                        C: { label: "관습형 (Conventional)", description: "체계적, 정확성, 데이터/규칙 관리를 선호하는 '조직가' 유형입니다. 질서정연하고, 책임감이 강하며, 꼼꼼하고 정확합니다. 정해진 규칙과 절차를 따르는 것을 편안하게 느끼며, 안정적이고 예측 가능한 환경을 선호합니다." }
                    },
                    careerData: [
                        { code: 'R', summary: '실용적, 신체적, 도구/기계 조작', major: '기계공학, 전기/전자공학, 건축학, 체육학, 농업생명과학, 조리학', job: '기술자, 엔지니어, 항공기 조종사/정비사, 소방관, 경찰관, 운동선수, 요리사, 건축가, 농부, 목수, 운전사, 군인' },
                        { code: 'I', summary: '분석적, 지적, 과학적/수학적 탐구', major: '자연과학(물리학, 화학, 생물학), 의/약학, 컴퓨터공학, 심리학, 사회과학, 경제학', job: '과학자, 의사, 약사, 수의사, 프로그래머, 데이터 분석가, 웹 개발자, 심리학자, 교수, 경제분석가, 변호사, 컨설턴트' },
                        { code: 'A', summary: '창의적, 표현적, 비구조적/심미적 활동', major: '미술, 음악, 디자인, 문예창작, 연극영화, 건축학, 광고홍보학', job: '화가, 음악가, 작가, 배우, 디자이너(패션, 그래픽, 제품), 건축사, 사진작가, 영화감독, 기자, 카피라이터, 웹툰 작가' },
                        { code: "S", summary: "협동적, 이타적, 타인 지원/교육", major: "교육학, 사회복지학, 상담심리학, 간호학, 신학, 언어치료학", job: "교사, 사회복지사, 상담사, 간호사, 언어치료사, 종교지도자, 인사(HR) 담당자, 고객 서비스 매니저, 마케팅 전문가" },
                        { code: 'E', summary: '설득적, 야망적, 리더십/경영 활동', major: '경영학, 경제학, 법학, 정치외교학, 광고홍보학, 호텔경영학', job: '경영인, CEO, 관리자, 영업사원, 변호사, 정치인, 펀드매니저, 부동산 중개인, 홍보 전문가, 판매 관리자, 컨설턴트' },
                        { code: 'C', summary: '체계적, 정확성, 데이터/규칙 관리', major: '회계학, 세무학, 통계학, 금융학, 문헌정보학, 법학, 행정학', job: '공인회계사, 세무사, 은행원, 사서, 법무사, 행정 공무원, 경리사원, 데이터베이스 관리자, 품질관리 전문가, 약사' },
                        { code: 'RI/IR', summary: '기술적 문제 해결, 연구 개발', major: '기계/전자공학, 컴퓨터공학, 산업공학, 생명공학', job: '연구개발(R&D) 엔지니어, 시스템 분석가, 의료기기 개발자, CAD 설계 전문가, 블록체인 전문가, 생체인식 전문가' },
                        { code: 'SA/AS', summary: '타인에 대한 창의적 표현/교육', major: '예술치료, 교육연극, 상담심리학, 특수교육', job: '예술치료사, 드라마 치료사, 음악 교사, 미술 교사, 청소년 지도사, 레크리에이션 지도자' },
                        { code: 'EC/CE', summary: '조직 관리 및 효율적 운영', major: '경영학, 회계학, 행정학, 산업공학', job: '프로젝트 매니저, 생산 관리자, 병원 행정가, 은행 지점장, 공공기관 관리자, 인사 관리자, 구매 담당자' },
                        { code: 'IA/AI', summary: '창의적 탐구, 아이디어 시각화', major: '과학 저널리즘, 데이터 시각화, 건축학, 게임 개발', job: '데이터 과학자, UX/UI 디자이너, 과학 기자, 게임 그래픽 디자이너, 건축가, 정보 디자이너' }
                    ]
                },
                synthesis: {
                    highE_highC_ESC: {
                        condition: (scores) => scores.bigFive.E >= 49 && scores.bigFive.C >= 49 && scores.riasecCode.startsWith('E'),
                        title: "성공적인 관리자 유형 (높은 외향성 + 높은 성실성 / 진취형)",
                        content: `<p>당신의 프로파일은 매우 일관성이 높습니다. 높은 <strong>외향성(E)</strong>은 사람들을 이끌고 설득하는 <strong>진취형(E)</strong> 및 <strong>사회형(S)</strong> 흥미와 완벽하게 부합합니다. 또한, 높은 <strong>성실성(C)</strong>은 체계적으로 업무를 관리하는 <strong>관습형(C)</strong> 흥미와 연결됩니다.</p><p>이러한 조합은 타고난 리더이면서도, 사람들을 잘 챙기고, 동시에 조직적이고 신뢰할 수 있는 특성을 모두 갖추고 있음을 의미합니다. 이는 성공적인 관리자, 영업 이사, 프로젝트 매니저, 혹은 자신의 사업을 운영하는 기업가에게서 흔히 볼 수 있는 전형적인 프로파일입니다.</p>`
                    },
                    highO_lowE_IAR: {
                        condition: (scores) => scores.bigFive.O >= 49 && scores.bigFive.E <= 36 && scores.riasecCode.startsWith('I'),
                        title: "창의적인 전문가 프로파일 (높은 개방성 + 낮은 외향성 / 탐구형)",
                        content: `<p>당신의 프로파일은 높은 일관성을 보입니다. 높은 <strong>개방성(O)</strong>은 지적 탐구(I)와 창의적 표현(A)에 대한 강한 흥미를 뒷받침합니다. 낮은 <strong>외향성(내향성)</strong>은 혼자 또는 소규모 그룹에서 깊이 있게 집중하는 것을 선호하는 <strong>탐구형(I)</strong>의 특성과 잘 맞습니다.</p><p>당신은 창의적이고 호기심 많은 사색가로, 독립적으로 일할 수 있는 환경에서 자신의 능력을 최대한 발휘할 수 있습니다. 연구 과학자, 데이터 분석가, 건축가, 작가, 소프트웨어 개발자 등의 역할에 매우 적합합니다.</p>`
                    },
                    highE_highA_IRC: {
                        condition: (scores) => scores.bigFive.E >= 49 && scores.bigFive.A >= 49 && (scores.riasecCode.startsWith('I') || scores.riasecCode.startsWith('R') || scores.riasecCode.startsWith('C')),
                        title: "복합적 프로파일 (잠재적 갈등과 기회)",
                        content: `<p>당신의 프로파일은 겉보기에 상충되는 요소들을 포함하고 있습니다. 성격적으로는 매우 사교적이고 사람 지향적(높은 <strong>외향성</strong>, 높은 <strong>우호성</strong>)이지만, 흥미는 주로 사물(R), 아이디어(I), 데이터(C)를 다루는 비-대인 활동에 집중되어 있습니다. 이는 '오류'가 아니라, 당신의 복잡성을 보여주는 중요한 데이터입니다. 다음과 같은 가능성을 탐색할 수 있습니다.</p>
                        <ul>
                            <li><strong>역할 내에서의 통합:</strong> 기술적인 업무(I, R, C)를 수행하되, 팀 프로젝트나 고객 기술 지원, 기술 영업과 같이 사람들과의 상호작용이 필수적인 역할을 찾아 자신의 사회적 욕구를 충족시킬 수 있습니다. 예를 들어, '사교적인 엔지니어'로서 팀을 이끌거나 고객과 소통하는 역할을 맡을 수 있습니다.</li>
                            <li><strong>일과 삶의 분리:</strong> 직업적으로는 자신의 흥미에 따라 깊이 있는 기술적/분석적 업무에 집중하여 전문성을 쌓고, 사교적 욕구는 직장 밖의 동호회, 사교 모임, 봉사활동 등 다양한 활동을 통해 충족시키는 전략을 사용할 수 있습니다.</li>
                        </ul>`
                    },
                    default: {
                        condition: () => true,
                        title: "개인 맞춤형 성장 전략",
                        content: `<p>당신의 성격과 흥미 조합은 고유한 강점과 잠재력을 가지고 있습니다. 자신의 성격(Big Five)이 직업적 흥미(RIASEC)와 어떻게 연결되는지 살펴보세요. 예를 들어, 높은 <strong>개방성</strong>은 <strong>예술형(A)</strong>이나 <strong>탐구형(I)</strong> 활동에 대한 흥미를 뒷받침할 수 있습니다. 높은 <strong>외향성</strong>은 <strong>진취형(E)</strong>이나 <strong>사회형(S)</strong> 역할에서 에너지를 발휘하게 합니다. 자신의 강점을 활용할 수 있는 환경을 찾고, 잠재적인 약점은 의식적으로 보완하는 전략을 세워보세요.</p>`
                    }
                }
            };
            
            let currentQuiz = '';
            let currentQuestionIndex = 0;
            let userAnswers = {};
            let quizScores = {};
            let userInfo = {};

            const introSection = document.getElementById('intro-section');
            const quizSection = document.getElementById('quiz-section');
            const resultsSection = document.getElementById('results-section');
            const adminSection = document.getElementById('admin-section');
            const startBtn = document.getElementById('start-btn');
            const quizTitle = document.getElementById('quiz-title');
            const quizSubtitle = document.getElementById('quiz-subtitle');
            const progressBar = document.getElementById('progress-bar');
            const questionContainer = document.getElementById('question-container');
            const questionCounter = document.getElementById('question-counter');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const restartBtn = document.getElementById('restart-btn');
            const adminLink = document.getElementById('admin-link');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const adminPasswordInput = document.getElementById('admin-password');
            const adminLoginSection = document.getElementById('admin-login');
            const adminResultsSection = document.getElementById('admin-results');
            const adminLogoutBtn = document.getElementById('admin-logout-btn');
            const userNameInput = document.getElementById('user-name');
            const userBirthdateInput = document.getElementById('user-birthdate');
            const introError = document.getElementById('intro-error');


            startBtn.addEventListener('click', () => {
                const name = userNameInput.value.trim();
                const birthdate = userBirthdateInput.value;
                if (!name || !birthdate) {
                    introError.textContent = '이름과 생년월일을 모두 입력해주세요.';
                    return;
                }
                introError.textContent = '';
                userInfo = { name, birthdate };
                startQuiz('bigFive');
            });

            prevBtn.addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    renderQuestion();
                }
            });

            nextBtn.addEventListener('click', () => {
                const currentAnswers = document.querySelectorAll(`input[name="q${currentQuestionIndex}"]`);
                let selected = false;
                currentAnswers.forEach(input => {
                    if (input.checked) selected = true;
                });

                if (!selected) {
                    alert('답변을 선택해주세요.');
                    return;
                }

                if (currentQuestionIndex < appData[currentQuiz].questions.length - 1) {
                    currentQuestionIndex++;
                    renderQuestion();
                } else {
                    calculateScores();
                    if (currentQuiz === 'bigFive') {
                        startQuiz('riasec');
                    } else {
                        saveResultsToFirebase();
                        showResults();
                    }
                }
            });
            
            restartBtn.addEventListener('click', () => {
                introSection.classList.remove('hidden');
                resultsSection.classList.add('hidden');
                quizScores = {};
                userAnswers = {};
                userInfo = {};
                userNameInput.value = '';
                userBirthdateInput.value = '';
            });

            adminLink.addEventListener('click', (e) => {
                e.preventDefault();
                introSection.classList.add('hidden');
                quizSection.classList.add('hidden');
                resultsSection.classList.add('hidden');
                adminSection.classList.remove('hidden');
                adminLoginSection.classList.remove('hidden');
                adminResultsSection.classList.add('hidden');
            });

            adminLoginBtn.addEventListener('click', () => {
                // For simplicity, using a hardcoded password. In a real app, use a secure auth system.
                if (adminPasswordInput.value === 'admin123') {
                    adminLoginSection.classList.add('hidden');
                    adminResultsSection.classList.remove('hidden');
                    loadAdminResults();
                } else {
                    alert('비밀번호가 틀렸습니다.');
                }
            });

            adminLogoutBtn.addEventListener('click', () => {
                adminSection.classList.add('hidden');
                introSection.classList.remove('hidden');
                adminPasswordInput.value = '';
            });

            async function saveResultsToFirebase() {
                try {
                    const docRef = await addDoc(collection(db, "assessments"), {
                        name: userInfo.name,
                        birthdate: userInfo.birthdate,
                        createdAt: serverTimestamp(),
                        bigFiveScores: quizScores.bigFive,
                        riasecScores: quizScores.riasec,
                        riasecCode: quizScores.riasecCode
                    });
                    console.log("Document written with ID: ", docRef.id);
                } catch (e) {
                    console.error("Error adding document: ", e);
                    alert("결과를 저장하는 데 실패했습니다. 인터넷 연결을 확인해주세요.");
                }
            }

            async function loadAdminResults() {
                const resultsBody = document.getElementById('admin-results-body');
                resultsBody.innerHTML = '<tr><td colspan="6" class="text-center p-4">결과를 불러오는 중...</td></tr>';
                try {
                    const q = query(collection(db, "assessments"), orderBy("createdAt", "desc"));
                    const querySnapshot = await getDocs(q);
                    let resultsHtml = '';
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const bigFiveStr = `N:${data.bigFiveScores.N}, E:${data.bigFiveScores.E}, O:${data.bigFiveScores.O}, A:${data.bigFiveScores.A}, C:${data.bigFiveScores.C}`;
                        const riasecStr = `R:${data.riasecScores.R}, I:${data.riasecScores.I}, A:${data.riasecScores.A}, S:${data.riasecScores.S}, E:${data.riasecScores.E}, C:${data.riasecScores.C}`;
                        const date = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleString('ko-KR') : '날짜 정보 없음';
                        const name = data.name || '정보 없음';
                        const birthdate = data.birthdate || '정보 없음';

                        resultsHtml += `
                            <tr class="border-b border-stone-200">
                                <td class="py-3 px-4 text-sm text-stone-600">${date}</td>
                                <td class="py-3 px-4 text-sm text-stone-800 font-bold">${name}</td>
                                <td class="py-3 px-4 text-sm text-stone-600">${birthdate}</td>
                                <td class="py-3 px-4 text-sm text-stone-600">${bigFiveStr}</td>
                                <td class="py-3 px-4 text-sm font-bold text-teal-700">${data.riasecCode}</td>
                                <td class="py-3 px-4 text-sm text-stone-600">${riasecStr}</td>
                            </tr>
                        `;
                    });
                    resultsBody.innerHTML = resultsHtml || '<tr><td colspan="6" class="text-center p-4">저장된 결과가 없습니다.</td></tr>';
                } catch (e) {
                    console.error("Error loading documents: ", e);
                    resultsBody.innerHTML = '<tr><td colspan="6" class="text-center p-4 text-red-500">결과를 불러오는 데 실패했습니다.</td></tr>';
                }
            }


            function startQuiz(quizType) {
                currentQuiz = quizType;
                currentQuestionIndex = 0;
                userAnswers[currentQuiz] = new Array(appData[currentQuiz].questions.length).fill(null);
                introSection.classList.add('hidden');
                resultsSection.classList.add('hidden');
                adminSection.classList.add('hidden');
                quizSection.classList.remove('hidden');
                quizTitle.textContent = appData[currentQuiz].title;
                quizSubtitle.textContent = appData[currentQuiz].subtitle;
                renderQuestion();
            }

            function renderQuestion() {
                const quizData = appData[currentQuiz];
                const questionData = quizData.questions[currentQuestionIndex];
                const totalQuestions = quizData.questions.length;
                
                let optionsHtml = '';
                const scaleLabels = currentQuiz === 'bigFive' 
                    ? ['전혀 그렇지 않다', '다소 그렇지 않다', '보통이다', '다소 그렇다', '매우 그렇다']
                    : ['매우 싫다', '싫다', '보통이다', '좋다', '매우 좋다'];

                for (let i = 1; i <= 5; i++) {
                    const isChecked = userAnswers[currentQuiz][currentQuestionIndex] === i ? 'checked' : '';
                    optionsHtml += `
                        <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-teal-50 has-[:checked]:bg-teal-100 has-[:checked]:border-teal-500 transition-colors">
                            <input type="radio" name="q${currentQuestionIndex}" value="${i}" class="mr-4 h-5 w-5 text-teal-600 focus:ring-teal-500" ${isChecked}>
                            <span class="text-stone-700">${i}. ${scaleLabels[i-1]}</span>
                        </label>
                    `;
                }

                questionContainer.innerHTML = `
                    <div class="mb-6">
                        <p class="text-xl font-medium text-stone-800">${currentQuestionIndex + 1}. ${questionData.q}</p>
                    </div>
                    <div class="space-y-3">${optionsHtml}</div>
                `;

                const radioButtons = document.querySelectorAll(`input[name="q${currentQuestionIndex}"]`);
                radioButtons.forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        userAnswers[currentQuiz][currentQuestionIndex] = parseInt(e.target.value);
                    });
                });

                updateControls(totalQuestions);
            }

            function updateControls(totalQuestions) {
                progressBar.style.width = `${((currentQuestionIndex + 1) / totalQuestions) * 100}%`;
                questionCounter.textContent = `${currentQuestionIndex + 1} / ${totalQuestions}`;
                prevBtn.style.visibility = currentQuestionIndex === 0 ? 'hidden' : 'visible';
                nextBtn.textContent = currentQuestionIndex === totalQuestions - 1 ? (currentQuiz === 'bigFive' ? '다음 검사로' : '결과 보기') : '다음';
            }

            function calculateScores() {
                if (currentQuiz === 'bigFive') {
                    const scores = { N: 0, E: 0, O: 0, A: 0, C: 0 };
                    const counts = { N: 0, E: 0, O: 0, A: 0, C: 0 };
                    appData.bigFive.questions.forEach((q, i) => {
                        let answer = userAnswers.bigFive[i];
                        if (q.score === -1) {
                            answer = 6 - answer;
                        }
                        scores[q.factor] += answer;
                        counts[q.factor]++;
                    });
                    quizScores.bigFive = scores;
                } else if (currentQuiz === 'riasec') {
                    const scores = { R: 0, I: 0, A: 0, S: 0, E: 0, C: 0 };
                    appData.riasec.questions.forEach((q, i) => {
                        scores[q.type] += userAnswers.riasec[i];
                    });
                    quizScores.riasec = scores;
                }
            }

            function showResults() {
                quizSection.classList.add('hidden');
                resultsSection.classList.remove('hidden');
                renderBigFiveResults();
                renderRiasecResults();
                renderSynthesisResults();
                renderCareerTable();
                setupTabs();
                setupCareerSearch();
            }
            
            function getScoreCategory(score, maxScore) {
                const percentage = (score / maxScore) * 100;
                if (percentage >= 81.6) return 'high'; // 49/60
                if (percentage <= 60) return 'low'; // 36/60
                return 'mid';
            }

            function renderBigFiveResults() {
                const labels = Object.values(appData.bigFive.interpretations).map(i => i.label);
                const data = Object.values(quizScores.bigFive);

                const ctx = document.getElementById('bigFiveChart').getContext('2d');
                new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '나의 성격 프로파일',
                            data: data,
                            backgroundColor: 'rgba(13, 148, 136, 0.2)',
                            borderColor: 'rgb(13, 148, 136)',
                            pointBackgroundColor: 'rgb(13, 148, 136)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgb(13, 148, 136)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                min: 12,
                                max: 60,
                                angleLines: { color: 'rgba(0, 0, 0, 0.1)' },
                                grid: { color: 'rgba(0, 0, 0, 0.1)' },
                                pointLabels: { font: { size: 14 } }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });

                const detailsContainer = document.getElementById('big-five-details');
                detailsContainer.innerHTML = '';
                Object.entries(quizScores.bigFive).forEach(([factor, score]) => {
                    const interpretation = appData.bigFive.interpretations[factor];
                    const category = getScoreCategory(score, 60);
                    const detailHtml = `
                        <div class="accordion-item border-b border-stone-200">
                            <button class="accordion-header w-full flex justify-between items-center py-4 text-left">
                                <span class="text-xl font-bold text-stone-800">${interpretation.label}</span>
                                <span class="text-teal-600 transform transition-transform duration-300">▼</span>
                            </button>
                            <div class="accordion-content overflow-hidden max-h-0 transition-all duration-500 ease-in-out">
                                <div class="p-4 pt-0">
                                    <p class="text-stone-600 mb-4">${interpretation.description}</p>
                                    <div class="bg-stone-100 p-4 rounded-lg">${interpretation[category]}</div>
                                </div>
                            </div>
                        </div>
                    `;
                    detailsContainer.innerHTML += detailHtml;
                });
                
                const summaryText = Object.entries(quizScores.bigFive).map(([factor, score]) => {
                    const category = getScoreCategory(score, 60);
                    let categoryText = '';
                    if (category === 'high') categoryText = '높은';
                    else if (category === 'low') categoryText = '낮은';
                    else categoryText = '보통 수준의';
                    return `${appData.bigFive.interpretations[factor].label}(${categoryText})`;
                }).join(', ');
                document.getElementById('big-five-summary').textContent = `당신은 ${summaryText} 특성을 보입니다. 상세 탭에서 각 요인에 대한 깊이 있는 해석을 확인해 보세요.`;

                addAccordionListeners();
            }
            
            function addAccordionListeners() {
                document.querySelectorAll('.accordion-header').forEach(button => {
                    button.addEventListener('click', () => {
                        const content = button.nextElementSibling;
                        const icon = button.querySelector('span:last-child');
                        if (content.style.maxHeight) {
                            content.style.maxHeight = null;
                            icon.style.transform = 'rotate(0deg)';
                        } else {
                            document.querySelectorAll('.accordion-content').forEach(c => c.style.maxHeight = null);
                            document.querySelectorAll('.accordion-header span:last-child').forEach(i => i.style.transform = 'rotate(0deg)');
                            content.style.maxHeight = content.scrollHeight + "px";
                            icon.style.transform = 'rotate(180deg)';
                        }
                    });
                });
            }

            function renderRiasecResults() {
                const labels = Object.values(appData.riasec.interpretations).map(i => i.label);
                const data = Object.values(quizScores.riasec);

                const ctx = document.getElementById('riasecChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '흥미 유형 점수',
                            data: data,
                            backgroundColor: [
                                'rgba(217, 119, 6, 0.6)',
                                'rgba(22, 163, 74, 0.6)',
                                'rgba(37, 99, 235, 0.6)',
                                'rgba(219, 39, 119, 0.6)',
                                'rgba(147, 51, 234, 0.6)',
                                'rgba(107, 114, 128, 0.6)'
                            ],
                            borderColor: [
                                'rgb(217, 119, 6)',
                                'rgb(22, 163, 74)',
                                'rgb(37, 99, 235)',
                                'rgb(219, 39, 119)',
                                'rgb(147, 51, 234)',
                                'rgb(107, 114, 128)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 40
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });

                const sortedRiasec = Object.entries(quizScores.riasec).sort(([, a], [, b]) => b - a);
                const hollandCode = sortedRiasec.slice(0, 3).map(([key]) => key).join('');
                quizScores.riasecCode = hollandCode;

                const detailsContainer = document.getElementById('riasec-details');
                detailsContainer.innerHTML = '';
                
                const summaryP = document.createElement('p');
                summaryP.className = 'text-2xl font-bold text-center mb-6';
                summaryP.innerHTML = `당신의 Holland 코드는 <span class="text-teal-600">${hollandCode}</span> 입니다.`;
                detailsContainer.appendChild(summaryP);

                sortedRiasec.slice(0, 3).forEach(([type, score]) => {
                    const interpretation = appData.riasec.interpretations[type];
                    const detailHtml = `
                        <div class="bg-stone-100 p-4 rounded-lg">
                            <h4 class="text-xl font-bold text-stone-800">${interpretation.label}</h4>
                            <p class="text-stone-600">${interpretation.description}</p>
                        </div>
                    `;
                    detailsContainer.innerHTML += detailHtml;
                });
                
                document.getElementById('riasec-summary').textContent = `당신의 직업 흥미 유형은 ${hollandCode}(${appData.riasec.interpretations[hollandCode[0]].label}, ${appData.riasec.interpretations[hollandCode[1]].label}, ${appData.riasec.interpretations[hollandCode[2]].label}) 순으로 높게 나타났습니다. 상세 탭에서 관련 직업 정보를 탐색해 보세요.`;
            }
            
            function renderSynthesisResults() {
                const container = document.getElementById('synthesis-details');
                container.innerHTML = '';
                let applied = false;
                for (const key in appData.synthesis) {
                    const rule = appData.synthesis[key];
                    if (rule.condition(quizScores)) {
                        container.innerHTML = `
                            <h3 class="text-2xl font-bold text-teal-700">${rule.title}</h3>
                            <div>${rule.content}</div>
                        `;
                        applied = true;
                        break;
                    }
                }
            }

            function renderCareerTable() {
                const tableBody = document.getElementById('career-table-body');
                tableBody.innerHTML = '';
                appData.riasec.careerData.forEach(item => {
                    const row = `
                        <tr class="border-b border-stone-200 hover:bg-stone-50">
                            <td class="py-3 px-4 font-bold text-teal-700">${item.code}</td>
                            <td class="py-3 px-4 text-stone-600">${item.summary}</td>
                            <td class="py-3 px-4 text-stone-600">${item.major}</td>
                            <td class="py-3 px-4 text-stone-600">${item.job}</td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });
            }
            
            function setupCareerSearch() {
                const searchInput = document.getElementById('career-search');
                searchInput.addEventListener('keyup', () => {
                    const filter = searchInput.value.toLowerCase();
                    const tableRows = document.querySelectorAll('#career-table-body tr');
                    tableRows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        if (text.includes(filter)) {
                            row.style.display = '';
                        } else {
                            row.style.display = 'none';
                        }
                    });
                });
            }

            function setupTabs() {
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabPanes = document.querySelectorAll('.tab-pane');

                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');

                        tabPanes.forEach(pane => {
                            pane.classList.add('hidden');
                            pane.classList.remove('active');
                        });

                        const targetTab = document.getElementById(`${button.dataset.tab}-tab`);
                        targetTab.classList.remove('hidden');
                        targetTab.classList.add('active');
                    });
                });
            }
        });
    </script>
</body>
</html>
